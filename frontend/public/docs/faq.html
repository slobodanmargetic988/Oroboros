<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ouroboros FAQ</title>
  <style>
    :root {
      --bg: #f3f7fd;
      --panel: #ffffff;
      --ink: #15233e;
      --muted: #56678b;
      --line: #d8e3f3;
      --brand: #0f54ff;
      --brand-soft: #e8efff;
      --shadow: 0 14px 34px rgba(18, 42, 86, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", "Avenir Next", "Helvetica Neue", Arial, sans-serif;
      color: var(--ink);
      line-height: 1.56;
      background:
        radial-gradient(1000px 500px at 95% -10%, #dce9ff 0%, transparent 60%),
        radial-gradient(900px 460px at -12% 0%, #ebf3ff 0%, transparent 58%),
        var(--bg);
    }

    .top-menu {
      position: sticky;
      top: 0;
      z-index: 90;
      border-bottom: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.97);
      backdrop-filter: blur(6px);
      padding: 0.55rem 1rem;
    }

    .top-menu-inner {
      width: min(1220px, calc(100% - 2rem));
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 0.55rem;
    }

    .top-link,
    .top-trigger {
      display: inline-block;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      background: #f8fafc;
      color: #0f172a;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.45rem 0.7rem;
      cursor: pointer;
      font-family: inherit;
      line-height: 1.2;
    }

    .top-link:hover,
    .top-trigger:hover {
      background: #eff6ff;
      color: #1e40af;
    }

    .top-link.is-active {
      border-color: #93c5fd;
      color: #1e3a8a;
    }

    .top-dropdown {
      position: relative;
    }

    .top-caret {
      margin-left: 0.3rem;
    }

    .top-panel {
      position: absolute;
      z-index: 20;
      margin-top: 0.45rem;
      min-width: 280px;
      display: none;
      gap: 0.2rem;
      border: 1px solid #d8e2ec;
      border-radius: 10px;
      background: #ffffff;
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.12);
      padding: 0.4rem;
    }

    .top-panel.is-open {
      display: grid;
    }

    .top-panel a {
      color: #1e293b;
      text-decoration: none;
      border-radius: 8px;
      padding: 0.42rem 0.5rem;
      font-size: 0.9rem;
    }

    .top-panel a:hover,
    .top-panel a.is-active {
      background: #eff6ff;
      color: #1e40af;
    }

    .wrap {
      width: min(1100px, calc(100% - 2rem));
      margin: 1.8rem auto 3rem;
    }

    .hero {
      position: relative;
      overflow: hidden;
      border: 1px solid var(--line);
      border-radius: 20px;
      background: linear-gradient(130deg, #f8fbff 0%, #edf3ff 100%);
      box-shadow: var(--shadow);
      padding: 2rem;
    }

    .hero-mark {
      position: absolute;
      top: 0px;
      right: 28px;
      width: auto;
      max-width: clamp(170px, 19vw, 250px);
      height: auto;
      max-height: 100%;
      opacity: 0.42;
      pointer-events: none;
      z-index: 0;
    }

    .hero> :not(.hero-mark) {
      position: relative;
      z-index: 1;
    }

    .eyebrow {
      margin: 0 0 0.4rem;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #2247a1;
      font-weight: 700;
    }

    h1 {
      margin: 0;
      line-height: 1.15;
      font-size: clamp(1.8rem, 3.8vw, 2.7rem);
    }

    .lead {
      margin: 0.8rem 0 0;
      color: #30436b;
      max-width: 95ch;
    }

    .section {
      margin-top: 1.05rem;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: var(--panel);
      box-shadow: var(--shadow);
      padding: 1rem;
    }

    .section h2 {
      margin: 0 0 0.55rem;
      font-size: 1.15rem;
    }

    details {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #fcfdff;
      padding: 0.7rem 0.75rem;
      margin-bottom: 0.55rem;
    }

    summary {
      cursor: pointer;
      font-weight: 600;
    }

    details p,
    details ul,
    details ol {
      margin: 0.55rem 0 0;
    }

    ul,
    ol {
      padding-left: 1.15rem;
    }

    li {
      margin-bottom: 0.35rem;
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 0.85rem;
      border: 1px solid #d5e0f3;
      border-radius: 6px;
      background: #f3f7ff;
      padding: 0.04rem 0.35rem;
    }

    .hint {
      border-left: 3px solid var(--brand);
      background: var(--brand-soft);
      color: #183468;
      border-radius: 8px;
      padding: 0.65rem 0.75rem;
      margin-top: 0.6rem;
    }

    @media (max-width: 720px) {
      .hero-mark {
        width: 132px;
        top: 16px;
        right: 16px;
        opacity: 0.3;
      }
    }
  </style>
</head>

<body>
  <nav class="top-menu" aria-label="Ouroboros navigation">
    <div class="top-menu-inner">
      <a class="top-link" href="/codex">Codex Inbox</a>
      <div class="top-dropdown" data-docs-menu>
        <button type="button" class="top-trigger" aria-haspopup="true" aria-expanded="false">
          Guides <span class="top-caret">▾</span>
        </button>
        <div class="top-panel" role="menu">
          <a href="/docs/public-user-guide.html">Public User Guide</a>
          <a href="/docs/developer-architecture-guide.html">Developer Architecture Guide</a>
          <a href="/docs/configuration-guide.html">Configuration Guide</a>
          <a href="/docs/platform-prerequisites-guide.html">Platform Prerequisites Guide</a>
          <a href="/docs/database-usage-guide.html">Database Usage Guide</a>
          <a href="/docs/faq.html">FAQ</a>
        </div>
      </div>
    </div>
  </nav>

  <main class="wrap">
    <header class="hero">
      <img class="hero-mark" src="../Ouroboros.png" alt="" />
      <p class="eyebrow">Ouroboros</p>
      <h1>Frequently Asked Questions</h1>
      <p class="lead">
        Quick answers for new users: setup, workflow, roles, failures, safety, scaling, recovery, and operations.
      </p>
    </header>

    <section class="section">
      <h2>Getting Started</h2>
      <details>
        <summary>What should I do in my first 10 minutes?</summary>
        <ol>
          <li>Copy env files: <code>.env</code>, <code>backend/.env</code>, <code>worker/.env</code>.</li>
          <li>Bootstrap DB: <code>./scripts/db-bootstrap.sh</code>.</li>
          <li>Start services (manual or host runtime).</li>
          <li>Open <code>/codex</code> and submit a small prompt.</li>
          <li>Wait for <code>preview_ready</code>, test preview, then approve/reject.</li>
        </ol>
      </details>
      <details>
        <summary>What is the minimum I need installed?</summary>
        <p>Git, Python 3.11+, Node 20+, PostgreSQL, Redis, and (for host-routed setup) Caddy.</p>
      </details>
      <details>
        <summary>Where do I start reading if I’m non-technical?</summary>
        <p>Start with <code>docs/public-user-guide.html</code>, then <code>docs/faq.html</code>.</p>
      </details>
    </section>

    <section class="section">
      <h2>Workflow and Roles</h2>
      <details>
        <summary>What are the role boundaries?</summary>
        <ul>
          <li>Owner: decides scope, approves/rejects runs.</li>
          <li>Developer agent: implements changes in slot worktrees.</li>
          <li>Tester: validates behavior/checks.</li>
          <li>Reviewer: verifies diff/risk/readiness for merge.</li>
        </ul>
      </details>
      <details>
        <summary>What do run statuses mean in plain language?</summary>
        <p>
          <code>queued</code> waiting, <code>planning/editing/testing</code> in progress,
          <code>preview_ready</code> ready to validate, <code>needs_approval</code> awaiting decision,
          <code>merged</code> done, <code>failed/canceled/expired</code> terminal non-success states.
        </p>
      </details>
      <details>
        <summary>How long should a run normally take?</summary>
        <p>Depends on change size. Small UI/text changes are usually minutes; cross-stack changes can take longer due to
          checks/review.</p>
      </details>
    </section>

    <section class="section">
      <h2>Failures and Recovery</h2>
      <details>
        <summary>What if a run is stuck in <code>queued</code>?</summary>
        <p>Most often all preview slots are occupied. Wait for release or clear blocked runs/leases.</p>
      </details>
      <details>
        <summary>What if checks fail?</summary>
        <p>Open run details, inspect failed checks/artifacts, fix, and retry as a child run.</p>
      </details>
      <details>
        <summary>What if preview DB is dirty from an old canceled run?</summary>
        <p>
          Worker now resets+seeds preview DB on slot claim before editing starts. If reset fails, run fails with
          <code>MIGRATION_FAILED</code> and lease is released.
        </p>
      </details>
      <details>
        <summary>What if merge conflicts happen?</summary>
        <p>Merge gate fails the run with conflict/error detail; you need a follow-up run with conflict resolution.</p>
      </details>
      <details>
        <summary>How do I rollback if a deploy is bad?</summary>
        <p>Use <code>./scripts/rollback.sh &lt;release_id&gt;</code>. It switches release symlink and runs health gate.
        </p>
      </details>
    </section>

    <section class="section">
      <h2>Safety and Security</h2>
      <details>
        <summary>Can this break production while testing preview?</summary>
        <p>Preview runs are isolated by slot worktree + preview DB. Production merge requires approval and merge gate
          checks.</p>
      </details>
      <details>
        <summary>Can worker commands run anything on my server?</summary>
        <p>
          Not by default. Worker enforces command allowlist and path allowlist, blocks shell wrappers, and runs with
          host hardening.
        </p>
      </details>
      <details>
        <summary>Where should secrets go?</summary>
        <p>Keep secrets out of preview env and use restricted env files (<code>/etc/oroboros/*.env</code>) with least
          privilege.</p>
      </details>
      <details>
        <summary>Is this containerized?</summary>
        <p>Current runtime is host-native (no Docker required). Docker support is possible but requires orchestration
          refactor.</p>
      </details>
    </section>

    <section class="section">
      <h2>Operations and Scaling</h2>
      <details>
        <summary>How many runs can work in parallel?</summary>
        <p>Parallel active previews are limited by slot count (default 3). Extra runs queue.</p>
      </details>
      <details>
        <summary>What should I monitor?</summary>
        <ul>
          <li>API/worker/proxy health endpoints</li>
          <li>run failure rate and queue depth</li>
          <li>slot utilization and stale lease cleanup</li>
          <li>preview DB reset failures</li>
        </ul>
      </details>
      <details>
        <summary>What survives restart, and what is disposable?</summary>
        <p>
          Control-plane DB state and releases persist. Preview runtime state is disposable and expected to be reset
          between runs.
        </p>
      </details>
      <details>
        <summary>How do I upgrade safely?</summary>
        <ol>
          <li>Pull code and run migrations.</li>
          <li>Deploy new release using deploy script or your controlled process.</li>
          <li>Run health checks and a smoke run.</li>
          <li>Rollback if health gate fails.</li>
        </ol>
      </details>
    </section>

    <section class="section">
      <h2>Limits and Expectations</h2>
      <details>
        <summary>What are known limitations today?</summary>
        <ul>
          <li>No built-in container orchestration path yet.</li>
          <li>Preview capacity tied to fixed slot count.</li>
          <li>Systemd automation is Linux-first; macOS/Windows often run manual process mode.</li>
        </ul>
      </details>
      <details>
        <summary>How do I know when to escalate to human intervention?</summary>
        <p>
          Escalate if repeated reset failures, repeated merge-gate failures, persistent queued backlog, or unclear
          safety impact.
        </p>
      </details>
      <div class="hint">
        Related docs:
        <code>docs/public-user-guide.html</code>,
        <code>docs/developer-architecture-guide.html</code>,
        <code>docs/configuration-guide.html</code>,
        <code>docs/platform-prerequisites-guide.html</code>,
        <code>docs/database-usage-guide.html</code>.
      </div>
    </section>
  </main>
  <script>
    (() => {
      const dropdown = document.querySelector("[data-docs-menu]");
      if (!dropdown) return;

      const trigger = dropdown.querySelector(".top-trigger");
      const panel = dropdown.querySelector(".top-panel");
      if (!trigger || !panel) return;

      const closeMenu = () => {
        panel.classList.remove("is-open");
        trigger.setAttribute("aria-expanded", "false");
      };

      trigger.addEventListener("click", (event) => {
        event.stopPropagation();
        const next = !panel.classList.contains("is-open");
        panel.classList.toggle("is-open", next);
        trigger.setAttribute("aria-expanded", String(next));
      });

      document.addEventListener("click", (event) => {
        if (!dropdown.contains(event.target)) {
          closeMenu();
        }
      });

      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          closeMenu();
        }
      });

      panel.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", closeMenu);
      });

      const current = window.location.pathname;
      document.querySelectorAll(".top-link, .top-panel a").forEach((link) => {
        if (link.getAttribute("href") === current) {
          link.classList.add("is-active");
        }
      });
    })();
  </script>
</body>

</html>